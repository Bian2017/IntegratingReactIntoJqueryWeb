
性能优化
---

项目背景：原项目是典型的MVC结构，前端页面的开发采用的是jQuery + ejs，通过NodeJS进行了路由跳转以及服务端渲染。

个人对jQuery用起来不是特别熟练，维护起来分外痛苦。其次，产品经理设计产品原型采用的是Ant Design，使用jQuery很难做到与产品设计的统一。

由于原项目已经很庞大，对项目代码进行重构不太现实，故只能针对后续需求的迭代开发采用React。在jQuery的基础上再采用React进行开发，会遇到不少性能问题，目前采用了如下方式进行了性能优化：

## 1. 提取公共文件

```JS
output: {
  path: path.join(__dirname, '../public/dist/work'),
  filename: "[name].js",
  chunkFilename: "[name].[chunkhash:8].js"    //不宜设置成[name].[hash:8].js
}
```

### 1.1 文件Hash摘要


在vendor.js中打包所有稳定不易变化的逻辑，比如应用的依赖库。在common.js中打包业务代码中的公共部分。针对这两个文件，加上hash码，并在node端设置浏览器缓存(max-age)。



+ hash：计算所有 chunks 的 hash；
+ chunkhash：为每个 chunk 计算hash；

第一种是每次编译生成一个唯一 hash，所有资源全打上同一个 hash。

第二种是 webpack 为每个 chunk 资源都生成与其内容相关的 hash 摘要，为不同的资源打上不同的 hash。

在本项目中，希望vendor.js存储react、react-dom等第三方库，而这些第三方库往往是稳定不易变化的，如果设置成[name].[hash:8].js，则每次业务代码变动都会导致文件Hash摘要发生变化，这样就失去了缓存的意义。


> 不要在开发环境使用 [chunkhash]/[hash]/[contenthash]，因为不需要在开发环境做持久缓存，而且这样会增加编译时间，开发环境用 [name] 就可以了。


值得注意的是：chunkhash并不稳定



### Ant Design按需加载


###  combo服务

### 浏览器缓存

304